<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Cloud Orders</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #8e24aa 0%, #5e35b1 100%); 
            min-height: 100vh; 
            color: #333; 
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { 
            background: white; 
            border-radius: 15px; 
            padding: 30px; 
            margin-bottom: 30px; 
            text-align: center; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
        }
        .restaurant-name { 
            font-size: 3rem; 
            color: #8e24aa; 
            margin-bottom: 15px; 
            font-weight: bold; 
        }
        .restaurant-tagline { 
            color: #666; 
            font-size: 1.3rem; 
            margin-bottom: 15px; 
        }
        .cloud-info { 
            background: linear-gradient(145deg, #f3e5f5, #e1bee7); 
            border: 2px solid #8e24aa; 
            padding: 25px; 
            border-radius: 15px; 
            margin-bottom: 30px; 
            box-shadow: 0 8px 25px rgba(142, 36, 170, 0.2); 
        }
        .info-title { 
            font-size: 1.4rem; 
            font-weight: bold; 
            color: #6a1b9a; 
            margin-bottom: 15px; 
            display: flex; 
            align-items: center; 
            gap: 10px; 
        }
        .info-description { 
            color: #7b1fa2; 
            margin-bottom: 20px; 
            font-size: 1.1rem; 
            line-height: 1.6; 
        }
        .table-input-section { 
            background: rgba(255, 255, 255, 0.9); 
            padding: 20px; 
            border-radius: 12px; 
            border: 2px solid #8e24aa; 
            text-align: center; 
        }
        .table-label { 
            font-size: 1.2rem; 
            font-weight: bold; 
            color: #6a1b9a; 
            margin-bottom: 15px; 
            display: block; 
        }
        .table-input { 
            width: 200px; 
            padding: 12px 20px; 
            border: 2px solid #8e24aa; 
            border-radius: 8px; 
            font-size: 1.5rem; 
            text-align: center; 
            font-weight: bold; 
            background: #fce4ec; 
        }
        .table-input:focus { 
            outline: none; 
            border-color: #5e35b1; 
            box-shadow: 0 0 0 3px rgba(142, 36, 170, 0.2); 
        }
        .content-grid { 
            display: grid; 
            grid-template-columns: 2fr 1fr; 
            gap: 30px; 
        }
        .menu-section { 
            background: white; 
            border-radius: 15px; 
            padding: 30px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
        }
        .menu-section h2 { 
            color: #8e24aa; 
            font-size: 2.2rem; 
            margin-bottom: 25px; 
            font-weight: bold; 
        }
        .menu-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); 
            gap: 20px; 
        }
        .menu-item { 
            border: 1px solid #ddd; 
            border-radius: 10px; 
            padding: 20px; 
            background: #fafafa; 
            transition: all 0.3s ease; 
        }
        .menu-item:hover { 
            transform: translateY(-3px); 
            box-shadow: 0 8px 25px rgba(0,0,0,0.15); 
            border-color: #8e24aa; 
        }
        .item-name { 
            font-size: 1.25rem; 
            font-weight: bold; 
            color: #333; 
            margin-bottom: 10px; 
        }
        .item-description { 
            color: #666; 
            margin-bottom: 15px; 
            line-height: 1.5; 
            font-size: 0.95rem; 
        }
        .item-footer { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        .item-price { 
            font-size: 1.4rem; 
            font-weight: bold; 
            color: #8e24aa; 
        }
        .add-btn { 
            background: #4caf50; 
            color: white; 
            border: none; 
            padding: 10px 18px; 
            border-radius: 6px; 
            cursor: pointer; 
            font-weight: 600; 
            transition: all 0.3s; 
        }
        .add-btn:hover { 
            background: #45a049; 
            transform: translateY(-1px); 
        }
        .cart-sidebar { 
            background: white; 
            border-radius: 15px; 
            padding: 30px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
            height: fit-content; 
            position: sticky; 
            top: 20px; 
        }
        .cart-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 25px; 
        }
        .cart-header h3 { 
            color: #8e24aa; 
            font-size: 1.5rem; 
            font-weight: bold; 
        }
        .cart-count { 
            background: #8e24aa; 
            color: white; 
            border-radius: 50%; 
            width: 32px; 
            height: 32px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-weight: bold; 
            font-size: 1rem; 
        }
        .cart-items { 
            max-height: 300px; 
            overflow-y: auto; 
            margin-bottom: 25px; 
        }
        .cart-item { 
            padding: 15px 0; 
            border-bottom: 1px solid #eee; 
        }
        .cart-item:last-child { 
            border-bottom: none; 
        }
        .cart-item-name { 
            font-weight: 600; 
            margin-bottom: 8px; 
            font-size: 1.05rem; 
        }
        .cart-item-price { 
            color: #666; 
            font-size: 0.9rem; 
            margin-bottom: 10px; 
        }
        .quantity-controls { 
            display: flex; 
            align-items: center; 
            gap: 12px; 
            margin-bottom: 10px; 
        }
        .qty-btn { 
            background: #8e24aa; 
            color: white; 
            border: none; 
            width: 28px; 
            height: 28px; 
            border-radius: 50%; 
            cursor: pointer; 
            font-size: 1rem; 
            font-weight: bold; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
        }
        .qty-btn:hover { 
            background: #7b1fa2; 
        }
        .qty-display { 
            min-width: 30px; 
            text-align: center; 
            font-weight: 600; 
            font-size: 1.1rem; 
        }
        .remove-btn { 
            background: #dc3545; 
            color: white; 
            border: none; 
            padding: 5px 10px; 
            border-radius: 4px; 
            cursor: pointer; 
            font-size: 0.85rem; 
            font-weight: 500; 
        }
        .remove-btn:hover { 
            background: #c82333; 
        }
        .cart-totals { 
            border-top: 2px solid #ddd; 
            padding-top: 20px; 
            margin-bottom: 25px; 
        }
        .total-row { 
            display: flex; 
            justify-content: space-between; 
            margin: 8px 0; 
            font-size: 1rem; 
        }
        .total-row.grand-total { 
            font-weight: bold; 
            font-size: 1.3rem; 
            color: #8e24aa; 
            border-top: 1px solid #ddd; 
            padding-top: 12px; 
            margin-top: 15px; 
        }
        .send-btn { 
            background: linear-gradient(45deg, #8e24aa, #5e35b1); 
            color: white; 
            border: none; 
            padding: 18px 25px; 
            border-radius: 10px; 
            cursor: pointer; 
            font-weight: 700; 
            text-align: center; 
            transition: all 0.3s; 
            font-size: 1.1rem; 
            width: 100%; 
            margin-bottom: 15px; 
            box-shadow: 0 4px 15px rgba(142, 36, 170, 0.3); 
        }
        .send-btn:hover { 
            background: linear-gradient(45deg, #7b1fa2, #512da8); 
            transform: translateY(-2px); 
            box-shadow: 0 6px 20px rgba(142, 36, 170, 0.4); 
        }
        .send-btn:disabled { 
            background: #6c757d; 
            cursor: not-allowed; 
            transform: none; 
            box-shadow: none; 
        }
        .clear-cart-btn { 
            background: #ffc107; 
            color: #212529; 
            padding: 12px 20px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: 600; 
            transition: all 0.3s; 
            width: 100%; 
        }
        .clear-cart-btn:hover { 
            background: #ffb300; 
            transform: translateY(-1px); 
        }
        .empty-cart { 
            text-align: center; 
            color: #666; 
            padding: 30px 0; 
            font-size: 1rem; 
        }
        .message { 
            padding: 15px 20px; 
            border-radius: 8px; 
            margin-bottom: 20px; 
            display: none; 
            font-weight: 500; 
            font-size: 0.95rem; 
        }
        .message.success { 
            background: #d4edda; 
            color: #155724; 
            border: 1px solid #c3e6cb; 
        }
        .message.error { 
            background: #f8d7da; 
            color: #721c24; 
            border: 1px solid #f5c6cb; 
        }
        .spinner { 
            display: inline-block; 
            width: 20px; 
            height: 20px; 
            border: 3px solid #f3f3f3; 
            border-top: 3px solid #8e24aa; 
            border-radius: 50%; 
            animation: spin 1s linear infinite; 
            margin-right: 10px; 
        }
        @keyframes spin { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(360deg); } 
        }
        .cloud-status { 
            background: #e3f2fd; 
            border: 1px solid #2196f3; 
            padding: 15px; 
            border-radius: 8px; 
            margin-bottom: 20px; 
            text-align: center; 
        }
        .cloud-status.sending { 
            background: #fff3e0; 
            border-color: #ff9800; 
        }
        .cloud-status.success { 
            background: #e8f5e9; 
            border-color: #4caf50; 
        }
        .cloud-status.error { 
            background: #ffebee; 
            border-color: #f44336; 
        }
        @media (max-width: 768px) { 
            .content-grid { 
                grid-template-columns: 1fr; 
            } 
            .restaurant-name { 
                font-size: 2.5rem; 
            } 
            .menu-grid { 
                grid-template-columns: 1fr; 
            } 
            .cart-sidebar { 
                position: static; 
            }
            .table-input {
                width: 150px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 class="restaurant-name">☁️ Cloud Restaurant</h1>
            <p class="restaurant-tagline">Ready-to-Deploy Global Ordering</p>
            <p style="color: #888; font-size: 0.9rem; margin-top: 5px;">Orders sent to real cloud database - Restaurant receives instantly</p>
        </header>

        <div class="cloud-info">
            <div class="info-title">
                ✅ Pre-Configured Cloud System
            </div>
            <div class="info-description">
                <strong>Ready to use!</strong> This system is pre-configured with your JSONBin.io credentials. When you place an order, it's automatically saved to the global cloud database. The restaurant's Android app will receive your order within seconds!
            </div>

            <div class="table-input-section">
                <label class="table-label">📍 Your Table Number</label>
                <input type="number" class="table-input" id="table-number" placeholder="5" min="1" max="50" required>
            </div>
        </div>

        <div id="cloud-status" class="cloud-status">
            ☁️ Cloud system ready - Place your order below
        </div>

        <div id="message" class="message"></div>

        <div class="content-grid">
            <section class="menu-section">
                <h2>Restaurant Menu</h2>
                <div id="menu-items" class="menu-grid"></div>
            </section>

            <aside class="cart-sidebar">
                <div class="cart-header">
                    <h3>Your Order</h3>
                    <span id="cart-count" class="cart-count">0</span>
                </div>

                <div id="cart-items" class="cart-items"></div>

                <div class="cart-totals">
                    <div class="total-row">
                        <span>Subtotal:</span>
                        <span id="subtotal">₹0</span>
                    </div>
                    <div class="total-row">
                        <span>Tax (5%):</span>
                        <span id="tax">₹0</span>
                    </div>
                    <div class="total-row grand-total">
                        <span>Total:</span>
                        <span id="total">₹0</span>
                    </div>
                </div>

                <button id="send-btn" class="send-btn" onclick="sendToCloud()">☁️ SEND TO RESTAURANT</button>
                <button class="clear-cart-btn" onclick="clearCart()">🗑️ Clear Cart</button>
            </aside>
        </div>
    </div>

    <script>
        // ☁️ PRE-CONFIGURED CLOUD STORAGE
        const CLOUD_CONFIG = {
            jsonBinApiKey: '$2a$10$sKN1nZNUuRh7v7M1gYrZNuBbPKkXMf7i/hWYKyBlkZ8RJV9r/VgAi',
            binId: '68d3f7c643b1c97be94e5143',
            baseUrl: 'https://api.jsonbin.io/v3/b'
        };

        // 🍽️ RESTAURANT MENU
        const MENU = [
            { id: 1, name: "Chicken Tikka", price: 280, description: "Tender chicken marinated in yogurt and spices, grilled to perfection" },
            { id: 2, name: "Paneer Butter Masala", price: 240, description: "Soft paneer cubes in rich tomato and butter gravy with aromatic spices" },
            { id: 3, name: "Butter Chicken", price: 320, description: "Classic creamy tomato curry with tender chicken pieces and Indian spices" },
            { id: 4, name: "Dal Makhani", price: 180, description: "Creamy black lentils slow-cooked with butter, cream, and traditional spices" },
            { id: 5, name: "Biryani (Chicken)", price: 350, description: "Fragrant basmati rice cooked with spiced chicken and aromatic herbs" },
            { id: 6, name: "Butter Naan", price: 60, description: "Fresh baked Indian bread brushed with butter and garlic" },
            { id: 7, name: "Garlic Naan", price: 70, description: "Soft naan bread topped with fresh garlic and coriander" },
            { id: 8, name: "Tandoori Roti", price: 45, description: "Whole wheat flatbread cooked in traditional tandoor oven" },
            { id: 9, name: "Mango Lassi", price: 120, description: "Refreshing yogurt drink blended with sweet mango pulp" },
            { id: 10, name: "Masala Chai", price: 40, description: "Traditional Indian spiced tea with milk and aromatic spices" },
            { id: 11, name: "Gulab Jamun", price: 80, description: "Soft milk dumplings soaked in rose-flavored sugar syrup" },
            { id: 12, name: "Raita", price: 60, description: "Cool yogurt side dish with cucumber, mint, and spices" }
        ];

        let cart = {};

        // Initialize system
        document.addEventListener('DOMContentLoaded', function() {
            console.log('☁️ Pre-configured cloud system loading...');
            console.log('🔑 API Key configured:', CLOUD_CONFIG.jsonBinApiKey.substring(0, 20) + '...');
            console.log('📦 Bin ID configured:', CLOUD_CONFIG.binId);

            renderMenu();
            updateCart();

            showMessage('✅ Cloud system ready! Your credentials are pre-configured.', 'success');
        });

        function renderMenu() {
            const container = document.getElementById('menu-items');
            if (!container) return;

            container.innerHTML = MENU.map(item => `
                <div class="menu-item">
                    <div class="item-name">${item.name}</div>
                    <div class="item-description">${item.description}</div>
                    <div class="item-footer">
                        <div class="item-price">₹${item.price}</div>
                        <button class="add-btn" onclick="addToCart(${item.id})">Add to Cart</button>
                    </div>
                </div>
            `).join('');
        }

        function addToCart(itemId) {
            const item = MENU.find(i => i.id === itemId);
            if (!item) return;

            if (cart[itemId]) {
                cart[itemId].quantity += 1;
            } else {
                cart[itemId] = { ...item, quantity: 1 };
            }

            updateCart();
            showMessage(`${item.name} added to cart!`, 'success');
        }

        function updateCart() {
            const items = Object.values(cart);
            const container = document.getElementById('cart-items');

            if (!container) return;

            if (items.length === 0) {
                container.innerHTML = '<div class="empty-cart">Your cart is empty<br><small>Add items from our menu!</small></div>';
                document.getElementById('cart-count').textContent = '0';
                document.getElementById('send-btn').disabled = true;
                updateTotals(0, 0, 0);
                return;
            }

            container.innerHTML = items.map(item => `
                <div class="cart-item">
                    <div class="cart-item-name">${item.name}</div>
                    <div class="cart-item-price">₹${item.price} each</div>
                    <div class="quantity-controls">
                        <button class="qty-btn" onclick="changeQuantity(${item.id}, -1)">−</button>
                        <span class="qty-display">${item.quantity}</span>
                        <button class="qty-btn" onclick="changeQuantity(${item.id}, 1)">+</button>
                    </div>
                    <button class="remove-btn" onclick="removeFromCart(${item.id})">Remove</button>
                </div>
            `).join('');

            const totalItems = items.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cart-count').textContent = totalItems;
            document.getElementById('send-btn').disabled = false;

            const subtotal = items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const tax = subtotal * 0.05;
            const total = subtotal + tax;

            updateTotals(subtotal, tax, total);
        }

        function changeQuantity(itemId, change) {
            if (cart[itemId]) {
                cart[itemId].quantity += change;
                if (cart[itemId].quantity <= 0) {
                    delete cart[itemId];
                }
                updateCart();
            }
        }

        function removeFromCart(itemId) {
            if (cart[itemId]) {
                const item = cart[itemId];
                delete cart[itemId];
                updateCart();
                showMessage(`${item.name} removed`, 'success');
            }
        }

        function updateTotals(subtotal, tax, total) {
            document.getElementById('subtotal').textContent = `₹${subtotal.toFixed(0)}`;
            document.getElementById('tax').textContent = `₹${tax.toFixed(0)}`;
            document.getElementById('total').textContent = `₹${total.toFixed(0)}`;
        }

        function clearCart() {
            if (Object.keys(cart).length > 0 && confirm('Clear cart?')) {
                cart = {};
                updateCart();
                showMessage('Cart cleared', 'success');
            }
        }

        // ☁️ SEND ORDER TO PRE-CONFIGURED CLOUD
        async function sendToCloud() {
            const items = Object.values(cart);
            if (items.length === 0) {
                showMessage('Cart is empty!', 'error');
                return;
            }

            // Validate table number
            const tableNumber = document.getElementById('table-number').value.trim();
            if (!tableNumber || isNaN(tableNumber) || tableNumber < 1) {
                showMessage('Please enter a valid table number!', 'error');
                return;
            }

            const sendBtn = document.getElementById('send-btn');
            const cloudStatus = document.getElementById('cloud-status');

            sendBtn.disabled = true;
            sendBtn.innerHTML = '<div class="spinner"></div>Uploading to cloud...';
            cloudStatus.className = 'cloud-status sending';
            cloudStatus.textContent = '☁️ Uploading order to restaurant cloud...';

            try {
                // Prepare order data
                const subtotal = items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                const tax = subtotal * 0.05;
                const total = subtotal + tax;
                const orderNumber = `C-${Date.now().toString().slice(-6)}`;
                const orderTime = new Date().toLocaleTimeString('en-IN', { 
                    hour: '2-digit', 
                    minute: '2-digit'
                });

                const orderData = {
                    orderNumber: orderNumber,
                    tableNumber: tableNumber,
                    items: items,
                    subtotal: subtotal.toFixed(0),
                    tax: tax.toFixed(0),
                    total: total.toFixed(0),
                    orderTime: orderTime,
                    timestamp: new Date().toISOString(),
                    status: "new",
                    cloudId: `cloud_${Date.now()}`,
                    deviceInfo: navigator.userAgent.substring(0, 100),
                    location: Intl.DateTimeFormat().resolvedOptions().timeZone
                };

                console.log('☁️ Uploading order to pre-configured cloud:', orderData);

                // Upload to cloud storage
                await uploadToConfiguredCloud(orderData);

                // Success
                cloudStatus.className = 'cloud-status success';
                cloudStatus.textContent = `✅ Order ${orderNumber} sent to restaurant! Table ${tableNumber}`;
                showMessage(`✅ Order sent successfully! ${orderNumber} for Table ${tableNumber} - ₹${total.toFixed(0)}`, 'success');

                // Clear cart
                cart = {};
                updateCart();
                document.getElementById('table-number').value = '';

            } catch (error) {
                console.error('❌ Cloud upload error:', error);
                cloudStatus.className = 'cloud-status error';
                cloudStatus.textContent = '❌ Failed to upload to cloud';
                showMessage(`❌ Failed to send order: ${error.message}`, 'error');
            } finally {
                sendBtn.disabled = false;
                sendBtn.innerHTML = '☁️ SEND TO RESTAURANT';
            }
        }

        // ☁️ UPLOAD TO PRE-CONFIGURED CLOUD STORAGE
        async function uploadToConfiguredCloud(orderData) {
            try {
                // First, get existing orders from cloud
                const getResponse = await fetch(`${CLOUD_CONFIG.baseUrl}/${CLOUD_CONFIG.binId}/latest`, {
                    method: 'GET',
                    headers: {
                        'X-Master-Key': CLOUD_CONFIG.jsonBinApiKey,
                        'X-Bin-Meta': 'false'
                    }
                });

                let existingData = { orders: [] };
                if (getResponse.ok) {
                    existingData = await getResponse.json();
                }

                // Add new order to beginning of array
                existingData.orders.unshift(orderData);

                // Keep only last 100 orders to prevent storage overflow
                if (existingData.orders.length > 100) {
                    existingData.orders = existingData.orders.slice(0, 100);
                }

                // Update metadata
                existingData.lastUpdated = new Date().toISOString();
                existingData.totalOrders = existingData.orders.length;

                // Upload updated data to cloud
                const putResponse = await fetch(`${CLOUD_CONFIG.baseUrl}/${CLOUD_CONFIG.binId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': CLOUD_CONFIG.jsonBinApiKey
                    },
                    body: JSON.stringify(existingData)
                });

                if (!putResponse.ok) {
                    throw new Error(`Cloud upload failed: ${putResponse.status}`);
                }

                console.log('✅ Order uploaded to configured cloud successfully');
                return orderData;

            } catch (error) {
                console.error('❌ Pre-configured cloud storage error:', error);
                throw error;
            }
        }

        function showMessage(text, type) {
            const msg = document.getElementById('message');
            if (!msg) return;

            msg.textContent = text;
            msg.className = `message ${type}`;
            msg.style.display = 'block';

            setTimeout(() => { 
                msg.style.display = 'none'; 
            }, 8000);
        }

        console.log('✅ Pre-configured cloud restaurant system loaded');
        console.log('☁️ Ready to send orders to restaurant with your credentials');
    </script>
</body>
</html>
