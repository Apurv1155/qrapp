<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Royal Cloud Restaurant</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts - Playfair Display and Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            width: 100%;
            overflow-x: hidden;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #fdfaf7;
            color: white;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            width: 100%;
            max-width: 100vw;
            overflow-x: hidden;
            position: relative;
        }

        .main-content {
            background-color: #081c37;
            color: white;
            width: 100%;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 100%;
            width: 100%;
            margin: 0 auto;
            overflow-x: hidden;
        }

        /* PERFECT RESPONSIVE GRID - NO OVERFLOW */
        .menu-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            width: 100%;
        }

        @media (min-width: 640px) {
            .menu-grid {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: 1.5rem;
            }
        }

        @media (min-width: 1024px) {
            .menu-grid {
                grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
                gap: 2rem;
            }
        }

        /* PERFECT CART SIDEBAR - NO OVERFLOW */
        .cart-sidebar {
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background-color: #25180a;
            z-index: 50;
            transition: transform 0.3s ease-in-out;
            transform: translateX(100%);
            padding: 1rem;
            box-shadow: -4px 0 12px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            max-width: 100vw;
        }

        @media (min-width: 1024px) {
            .cart-sidebar {
                position: static;
                width: auto;
                height: auto;
                transform: translateX(0);
                box-shadow: none;
                padding: 1.5rem;
                overflow-y: visible;
                max-width: none;
            }
        }

        .cart-sidebar.open {
            transform: translateX(0);
        }

        .cart-items {
            max-height: calc(100vh - 300px);
            overflow-y: auto;
            width: 100%;
        }

        @media (min-width: 1024px) {
            .cart-items {
                max-height: calc(100vh - 200px);
            }
        }

        .hidden {
            background-color: #081c37;
            color: white;
        }

        /* PERFECT SPLASH SCREEN - NO OVERFLOW */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #f2e3e3;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 1s ease-in-out;
            opacity: 1;
            overflow: hidden;
        }

        .logo-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            width: 100%;
            animation: blur-to-visible 1.5s forwards;
            padding: 1rem;
            max-width: 100%;
        }

        .logo-container img {
            max-width: 80%;
            max-height: 50vh;
            height: auto;
            display: block;
        }

        .logo-text {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            font-weight: 800;
            color: #1f2937;
            letter-spacing: -1px;
        }

        @media (min-width: 640px) {
            .logo-text {
                font-size: 2.5rem;
            }
        }

        @media (min-width: 768px) {
            .logo-text {
                font-size: 3rem;
            }
        }

        @keyframes blur-to-visible {
            0% {
                opacity: 0;
                filter: blur(10px);
                transform: scale(0.9);
            }
            100% {
                opacity: 1;
                filter: blur(0);
                transform: scale(1);
            }
        }

        .cart-items::-webkit-scrollbar {
            width: 6px;
        }

        .cart-items::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 4px;
        }

        .cart-items::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        h2.royal, h3.royal {
            font-family: 'Playfair Display', serif;
        }

        /* PERFECT SEARCH MODAL - NO OVERFLOW */
        .search-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 60;
            transition: opacity 0.3s ease-in-out;
            opacity: 0;
            padding: 0.5rem;
            overflow: hidden;
        }

        .search-modal {
            background: #fff;
            padding: 1rem;
            border-radius: 1rem;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 95vw;
            max-height: 85vh;
            overflow-y: auto;
            transform: translateY(-20px);
            transition: transform 0.3s ease-in-out;
        }

        @media (min-width: 640px) {
            .search-modal {
                padding: 1.5rem;
                border-radius: 1.5rem;
                max-width: 600px;
                max-height: 80vh;
            }
        }

        .search-modal-overlay.open {
            display: flex;
            opacity: 1;
        }

        .search-modal-overlay.open .search-modal {
            transform: translateY(0);
        }

        /* SEARCH INPUT - PERFECTLY VISIBLE */
        .search-input {
            background: white;
            border: 2px solid #e5e7eb;
            color: #1f2937 !important;
            font-size: 16px;
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            width: 100%;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .search-input:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
            color: #1f2937 !important;
        }

        .search-input::placeholder {
            color: #9ca3af !important;
            font-weight: 400;
        }

        /* SEARCH SUGGESTIONS - VISIBLE TEXT */
        .search-suggestions {
            max-height: 300px;
            overflow-y: auto;
            border-top: 1px solid #e5e7eb;
        }

        .suggestion-item {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #f3f4f6;
            cursor: pointer;
            transition: background-color 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: #374151 !important;
            font-weight: 500;
        }

        .suggestion-item:hover {
            background-color: #f9fafb;
            color: #1f2937 !important;
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-highlight {
            background-color: #fef3c7;
            padding: 0.125rem 0.25rem;
            border-radius: 0.25rem;
            font-weight: 600;
            color: #92400e !important;
        }

        /* SEARCH RESULTS - VISIBLE WITH ADD TO CART */
        .search-results {
            margin-top: 1rem;
        }

        .search-result-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            transition: all 0.2s ease;
            background: white;
            width: 100%;
        }

        .search-result-item:hover {
            border-color: #4f46e5;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .search-result-image {
            width: 50px;
            height: 50px;
            border-radius: 0.5rem;
            object-fit: cover;
            flex-shrink: 0;
        }

        .search-result-info {
            flex: 1;
            min-width: 0;
        }

        .search-result-name {
            font-weight: 600;
            color: #1f2937 !important;
            margin-bottom: 0.25rem;
            font-size: 14px;
        }

        .search-result-description {
            font-size: 0.75rem;
            color: #6b7280 !important;
            line-height: 1.25;
        }

        .search-result-price {
            font-weight: 700;
            color: #dc2626 !important;
            font-size: 1rem;
            margin-right: 0.5rem;
        }

        .search-add-btn {
            background: #4f46e5;
            color: white;
            padding: 0.375rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .search-add-btn:hover {
            background: #4338ca;
            transform: translateY(-1px);
        }

        .no-results {
            text-align: center;
            padding: 2rem 1rem;
            color: #6b7280 !important;
        }

        /* POPULAR SEARCHES - VISIBLE TEXT */
        .popular-searches {
            margin-top: 1rem;
        }

        .popular-search-tag {
            display: inline-block;
            background: #f3f4f6;
            color: #374151 !important;
            padding: 0.375rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            margin: 0.25rem;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
        }

        .popular-search-tag:hover {
            background: #e5e7eb;
            color: #1f2937 !important;
        }

        /* PERFECT MOBILE RESPONSIVE - NO HORIZONTAL SCROLL */
        @media (max-width: 767px) {
            .container {
                padding-left: 0.5rem;
                padding-right: 0.5rem;
            }

            .nav-buttons {
                gap: 0.25rem;
            }

            .nav-buttons input {
                width: 3rem;
                font-size: 0.75rem;
                padding: 0.25rem;
            }

            .nav-buttons label {
                display: none;
            }
        }

        @media (max-width: 375px) {
            /* iPhone SE specific fixes */
            .container {
                padding-left: 0.25rem;
                padding-right: 0.25rem;
                width: 100%;
                max-width: 100%;
            }

            .menu-grid {
                gap: 0.75rem;
            }

            .nav-buttons input {
                width: 2.5rem;
                font-size: 0.65rem;
            }
        }
    </style>
</head>

<body class="bg-stone-50 flex flex-col min-h-screen">

<!-- Splash Screen -->
<div id="splash-screen" class="hidden">
    <div class="logo-container">
        <img src="nextgen.png" alt="">
    </div>
</div>

<div id="main-content" class="hidden">
    <!-- PERFECT MOBILE HEADER - NO OVERFLOW -->
    <header class="sticky top-0 z-50 shadow-lg shadow-black/5 rounded-b-2xl text-white w-full" style="background-color: #081c37;">
        <nav class="container mx-auto px-2 sm:px-4 lg:px-8 py-2 sm:py-4 flex justify-between items-center">
            <!-- Company Logo and Name -->
            <a href="#" class="flex items-center space-x-1 sm:space-x-2 flex-shrink-0">
                <img src="https://aambli.club/wp-content/uploads/2024/05/Aambli-Logo.svg" alt="The Grand Plate Logo" class="h-6 sm:h-8 lg:h-10 w-auto">
                <span class="font-extrabold text-sm sm:text-lg lg:text-xl font-['Playfair_Display']">Ultra Pro</span>
            </a>

            <!-- Cart Button - Responsive -->
            <div class="flex items-center space-x-1 sm:space-x-2 lg:space-x-4 nav-buttons">
                <div id="table-input-section" class="flex items-center space-x-1">
                    <label for="table-number" class="text-sm font-medium hidden sm:inline">Table No:</label>
                    <input type="number" id="table-number" placeholder="1-50" min="1" max="50" class="w-12 sm:w-16 lg:w-20 p-1 sm:p-2 text-sm border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-rose-500 transition-colors text-black">
                </div>

                <button onclick="toggleSearchModal()" class="relative p-1.5 sm:p-2 rounded-xl hover:bg-indigo-900 transition-colors">
                    <svg class="w-4 h-4 sm:w-5 sm:h-5 lg:w-6 lg:h-6 text-white" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                </button>

                <button onclick="toggleCart()" class="relative p-1.5 sm:p-2 rounded-xl hover:bg-indigo-900 transition-colors">
                    <svg class="w-4 h-4 sm:w-5 sm:h-5 lg:w-6 lg:h-6 text-white" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="9" cy="21" r="1"></circle>
                        <circle cx="20" cy="21" r="1"></circle>
                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                    </svg>
                    <span id="cart-count" class="absolute top-0 right-0 inline-flex items-center justify-center px-1.5 py-0.5 text-xs font-bold leading-none text-white transform translate-x-1/2 -translate-y-1/2 bg-rose-600 rounded-full">0</span>
                </button>
            </div>
        </nav>
    </header>

    <!-- PERFECT CONTENT GRID - NO OVERFLOW -->
    <div class="container mx-auto px-2 sm:px-4 lg:px-8 mt-4 sm:mt-6 lg:mt-8 grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6 lg:gap-8 text-white" style="color: white;">
        <!-- Menu Section -->
        <section class="lg:col-span-2 w-full">
            <h2 class="text-2xl sm:text-3xl lg:text-4xl royal font-bold mb-4 sm:mb-6 lg:mb-8">Explore Our Menu</h2>

            <div id="categories" class="flex flex-wrap gap-1 sm:gap-2 mb-3 sm:mb-4 lg:mb-6"></div>

            <!-- Search Results Section -->
            <div id="search-results-section" class="hidden mb-4 sm:mb-6">
                <div class="flex items-center justify-between mb-3 sm:mb-4">
                    <h3 class="text-lg sm:text-xl lg:text-2xl royal font-semibold">Search Results</h3>
                    <button onclick="clearSearch()" class="text-sm text-gray-400 hover:text-white transition-colors">Clear Search</button>
                </div>
                <div id="search-results-container"></div>
            </div>

            <div id="menu-items" class="menu-grid"></div>
        </section>

        <!-- PERFECT CART SIDEBAR -->
        <aside id="cart-sidebar" class="bg-white p-3 sm:p-4 lg:p-6 rounded-2xl sm:rounded-3xl shadow-2xl lg:sticky lg:top-24 overflow-y-auto cart-sidebar">
            <div id="previous-order-section" class="mb-3 sm:mb-4 lg:mb-6 hidden">
                <h3 class="text-base sm:text-lg lg:text-xl royal font-semibold mb-2">Previous Order</h3>
                <div id="previous-order-content" class="p-2 sm:p-3 lg:p-4 bg-gray-50 rounded-xl border border-gray-200"></div>
            </div>

            <div class="flex justify-between items-center mb-3 sm:mb-4 lg:mb-6">
                <h3 class="text-lg sm:text-xl lg:text-2xl royal font-semibold">Your Order</h3>
                <button onclick="toggleCart()" class="lg:hidden p-2 rounded-full hover:bg-gray-100 transition-colors bg-black text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x">
                        <path d="M18 6 6 18"></path>
                        <path d="m6 6 12 12"></path>
                    </svg>
                </button>
            </div>

            <div id="cart-items" class="space-y-2 sm:space-y-3 lg:space-y-4 overflow-y-auto cart-items w-full"></div>

            <div class="mt-3 sm:mt-4 lg:mt-6 pt-3 sm:pt-4 lg:pt-6 border-t border-gray-200">
                <div class="flex justify-between text-base sm:text-lg font-medium mb-2">
                    <span>Total</span>
                    <span id="total">₹0</span>
                </div>
            </div>

            <div id="message" class="hidden my-3 sm:my-4 p-2 sm:p-3 rounded-xl text-sm font-medium"></div>

            <button id="send-btn" class="w-full mt-3 sm:mt-4 py-2 sm:py-3 px-3 sm:px-4 lg:px-6 rounded-xl text-white font-semibold transition-all duration-300 bg-gradient-to-r from-indigo-950 to-purple-900 hover:from-indigo-900 hover:to-purple-800 focus:outline-none focus:ring-4 focus:ring-rose-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2" onclick="sendToCloud()">
                <svg class="w-4 h-4 sm:w-5 sm:h-5 animate-spin text-white hidden" id="spinner" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span id="send-btn-text" class="text-sm sm:text-base">Send Order</span>
            </button>
        </aside>
    </div>

    <!-- PERFECT SEARCH MODAL -->
    <div id="search-modal-overlay" class="search-modal-overlay" onclick="closeSearchModal(event)">
        <div class="search-modal" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center mb-3 sm:mb-4">
                <h3 class="text-lg sm:text-xl lg:text-2xl royal font-semibold text-gray-800">Search Menu</h3>
                <button onclick="closeSearchModal()" class="p-2 rounded-full hover:bg-gray-100 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x">
                        <path d="M18 6 6 18"></path>
                        <path d="m6 6 12 12"></path>
                    </svg>
                </button>
            </div>

            <div class="mb-3 sm:mb-4">
                <input type="text" id="search-input" placeholder="Search for dishes... (e.g., Tikka, Paneer, Rice)" class="search-input" oninput="handleSearchInput()" onkeydown="handleSearchKeydown(event)">
            </div>

            <!-- Popular Searches -->
            <div id="popular-searches" class="popular-searches">
                <h4 class="text-sm font-semibold text-gray-700 mb-2">Popular Searches:</h4>
                <div class="flex flex-wrap">
                    <span class="popular-search-tag" onclick="searchFor('chicken')">Chicken</span>
                    <span class="popular-search-tag" onclick="searchFor('paneer')">Paneer</span>
                    <span class="popular-search-tag" onclick="searchFor('biryani')">Biryani</span>
                    <span class="popular-search-tag" onclick="searchFor('masala')">Masala</span>
                    <span class="popular-search-tag" onclick="searchFor('spicy')">Spicy</span>
                </div>
            </div>

            <!-- Search Suggestions -->
            <div id="search-suggestions" class="search-suggestions hidden"></div>

            <!-- Search Results -->
            <div id="modal-search-results" class="search-results hidden"></div>

            <!-- Action Buttons -->
            <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 mt-3 sm:mt-4">
                <button onclick="performSearch()" class="bg-indigo-950 text-white px-3 sm:px-4 lg:px-6 py-2 sm:py-3 rounded-lg font-medium shadow-md hover:bg-indigo-900 transition-colors flex-1">Search</button>
                <button onclick="clearModalSearch()" class="bg-gray-500 text-white px-3 sm:px-4 lg:px-6 py-2 sm:py-3 rounded-lg font-medium hover:bg-gray-600 transition-colors">Clear</button>
            </div>
        </div>
    </div>
</div>

<script>
    // GOOGLE APPS SCRIPT URL - YOUR ACTUAL URL
    const GOOGLE_APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwr1_9lc-dqmQMLOsrZyur1lGSP19bR3loVGQU0-ZM4f0XTILJ9UYWHqy9zHwpPLwmEEg/exec";

    // RESTAURANT MENU - Your exact menu with enhanced search data
    const MENU = [
        {
            id: 1,
            name: "Chicken Tikka",
            price: 280,
            description: "Tender chicken marinated in yogurt and spices, grilled to perfection",
            image: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgZmlsbD0iI2Y0ZjVmNyIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXNpemU9IjE4cHgiIGZpbGw9IiM2YjczODAiPkNoaWNrZW4gVGlra2E8L3RleHQ+PC9zdmc+",
            category: "Main Course",
            searchTerms: ["chicken", "tikka", "grilled", "spicy", "indian", "starter", "non-veg", "protein"]
        },
        {
            id: 2,
            name: "Paneer Butter Masala",
            price: 240,
            description: "Soft paneer cubes in rich tomato and butter gravy with aromatic spices",
            image: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgZmlsbD0iI2Y0ZjVmNyIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXNpemU9IjE4cHgiIGZpbGw9IiM2YjczODAiPlBhbmVlciBCdXR0ZXIgTWFzYWxhPC90ZXh0Pjwvc3ZnPg==",
            category: "Main Course",
            searchTerms: ["paneer", "butter", "masala", "vegetarian", "veg", "tomato", "gravy", "creamy", "indian", "cheese"]
        },
        {
            id: 3,
            name: "Butter Chicken",
            price: 320,
            description: "Classic creamy tomato curry with tender chicken pieces and Indian spices",
            image: "https://img.freepik.com/premium-photo/delicious-chicken-butter-masala-curry-served-bowl-with-butter-naan_466689-53748.jpg",
            category: "Main Course",
            searchTerms: ["butter", "chicken", "curry", "creamy", "tomato", "indian", "popular", "mild", "non-veg"]
        },
        {
            id: 4,
            name: "Dal Makhani",
            price: 180,
            description: "Creamy black lentils slow-cooked with butter, cream, and traditional spices",
            image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTJyxriYQbeflEz-oI5M2-GmBq8HzAtF1D7A&s",
            category: "Main Course",
            searchTerms: ["dal", "makhani", "lentils", "vegetarian", "veg", "creamy", "butter", "traditional", "healthy"]
        },
        {
            id: 5,
            name: "Biryani Chicken",
            price: 350,
            description: "Fragrant basmati rice cooked with spiced chicken and aromatic herbs",
            image: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgZmlsbD0iI2Y0ZjVmNyIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXNpemU9IjE4cHgiIGZpbGw9IiM2YjczODAiPkJpcnlhbmkgQ2hpY2tlbjwvdGV4dD48L3N2Zz4=",
            category: "Main Course",
            searchTerms: ["biryani", "chicken", "rice", "basmati", "aromatic", "spiced", "herbs", "indian", "non-veg", "fragrant"]
        }
    ];

    // Variables
    let cart = {};
    let isCartVisible = false;
    let currentSearchQuery = '';
    let searchSuggestions = [];

    // Initialize system
    document.addEventListener('DOMContentLoaded', function() {
        showSplashScreen();
        displayPreviousOrder();
        generateSearchSuggestions();
    });

    function generateSearchSuggestions() {
        // Generate search suggestions from menu items
        const suggestions = new Set();
        MENU.forEach(item => {
            suggestions.add(item.name);
            if (item.searchTerms) {
                item.searchTerms.forEach(term => suggestions.add(term));
            }
        });
        searchSuggestions = Array.from(suggestions).sort();
    }

    function showSplashScreen() {
        const splashScreen = document.getElementById('splash-screen');
        const mainContent = document.getElementById('main-content');

        splashScreen.style.display = 'flex';
        mainContent.style.display = 'none';

        setTimeout(() => {
            splashScreen.style.opacity = '0';
            setTimeout(() => {
                splashScreen.style.display = 'none';
                mainContent.style.display = 'block';
                renderCategories();
                renderMenu();
                updateCart();
            }, 1000);
        }, 2000);
    }

    function toggleCart() {
        const cartSidebar = document.getElementById('cart-sidebar');
        isCartVisible = !isCartVisible;
        if (isCartVisible) {
            cartSidebar.classList.add('open');
        } else {
            cartSidebar.classList.remove('open');
        }
    }

    function toggleSearchModal() {
        const modal = document.getElementById('search-modal-overlay');
        if (modal.classList.contains('open')) {
            modal.classList.remove('open');
        } else {
            modal.classList.add('open');
            document.getElementById('search-input').focus();
            showPopularSearches();
        }
    }

    function closeSearchModal(event) {
        if (event && event.target.closest('.search-modal')) return;
        document.getElementById('search-modal-overlay').classList.remove('open');
        clearModalSearch();
    }

    function showPopularSearches() {
        document.getElementById('popular-searches').classList.remove('hidden');
        document.getElementById('search-suggestions').classList.add('hidden');
        document.getElementById('modal-search-results').classList.add('hidden');
    }

    function handleSearchInput() {
        const query = document.getElementById('search-input').value.toLowerCase().trim();
        currentSearchQuery = query;

        if (query.length === 0) {
            showPopularSearches();
            return;
        }

        if (query.length >= 1) {
            showSearchSuggestions(query);
        }

        if (query.length >= 2) {
            showModalSearchResults(query);
        }
    }

    function showSearchSuggestions(query) {
        const suggestionsContainer = document.getElementById('search-suggestions');
        const filteredSuggestions = searchSuggestions.filter(suggestion => 
            suggestion.toLowerCase().includes(query) && suggestion.toLowerCase() !== query
        ).slice(0, 8);

        if (filteredSuggestions.length === 0) {
            suggestionsContainer.classList.add('hidden');
            return;
        }

        const suggestionsHTML = filteredSuggestions.map(suggestion => {
            const highlightedSuggestion = suggestion.replace(
                new RegExp(`(${query})`, 'gi'),
                '<span class="suggestion-highlight">$1</span>'
            );
            return `
                <div class="suggestion-item" onclick="searchFor('${suggestion}')">
                    <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                    <span>${highlightedSuggestion}</span>
                </div>
            `;
        }).join('');

        suggestionsContainer.innerHTML = suggestionsHTML;
        suggestionsContainer.classList.remove('hidden');
        document.getElementById('popular-searches').classList.add('hidden');
    }

    function showModalSearchResults(query) {
        const results = searchMenu(query);
        const resultsContainer = document.getElementById('modal-search-results');

        if (results.length === 0) {
            resultsContainer.innerHTML = `
                <div class="no-results">
                    <svg class="w-12 h-12 text-gray-300 mx-auto mb-3" fill="none" stroke="currentColor" stroke-width="1" viewBox="0 0 24 24">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                    <p class="text-sm">No dishes found for "${query}"</p>
                    <p class="text-xs mt-2">Try searching for "chicken", "paneer", or "biryani"</p>
                </div>
            `;
        } else {
            const resultsHTML = results.map(item => `
                <div class="search-result-item">
                    <img src="${item.image}" alt="${item.name}" class="search-result-image">
                    <div class="search-result-info">
                        <div class="search-result-name">${item.name}</div>
                        <div class="search-result-description">${item.description}</div>
                    </div>
                    <div class="search-result-price">₹${item.price}</div>
                    <button class="search-add-btn" onclick="addToCartFromSearch(${item.id})">Add to Cart</button>
                </div>
            `).join('');

            resultsContainer.innerHTML = `
                <h4 class="text-sm font-semibold text-gray-700 mb-3">Found ${results.length} dish${results.length > 1 ? 'es' : ''}:</h4>
                ${resultsHTML}
            `;
        }

        resultsContainer.classList.remove('hidden');
    }

    function searchFor(term) {
        document.getElementById('search-input').value = term;
        currentSearchQuery = term.toLowerCase();
        handleSearchInput();
    }

    function handleSearchKeydown(event) {
        if (event.key === 'Enter') {
            performSearch();
        }
    }

    function searchMenu(query) {
        return MENU.filter(item => {
            const searchInName = item.name.toLowerCase().includes(query);
            const searchInDescription = item.description.toLowerCase().includes(query);
            const searchInTerms = item.searchTerms && item.searchTerms.some(term => 
                term.toLowerCase().includes(query)
            );
            return searchInName || searchInDescription || searchInTerms;
        });
    }

    function performSearch() {
        const query = document.getElementById('search-input').value.toLowerCase().trim();
        if (!query) return;

        const results = searchMenu(query);
        displaySearchResults(results, query);
        closeSearchModal();
    }

    function displaySearchResults(results, query) {
        const searchResultsSection = document.getElementById('search-results-section');
        const resultsContainer = document.getElementById('search-results-container');

        if (results.length === 0) {
            resultsContainer.innerHTML = `
                <div class="text-center py-8">
                    <svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" stroke-width="1" viewBox="0 0 24 24">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                    <p class="text-gray-400 text-lg mb-2">No dishes found for "${query}"</p>
                    <p class="text-gray-500 text-sm">Try searching for "chicken", "paneer", "biryani", or "masala"</p>
                </div>
            `;
        } else {
            resultsContainer.innerHTML = `
                <div class="mb-4">
                    <p class="text-gray-300 text-sm">Found ${results.length} dish${results.length > 1 ? 'es' : ''} for "${query}"</p>
                </div>
                <div class="menu-grid">
                    ${results.map(item => `
                        <div class="bg-white rounded-2xl shadow-xl overflow-hidden transform transition duration-300 hover:scale-105">
                            <div class="relative w-full h-40 sm:h-48 bg-gray-100">
                                <img src="${item.image}" alt="${item.name}" class="w-full h-full object-cover rounded-t-2xl">
                            </div>

                            <div class="p-4 sm:p-6">
                                <h3 class="text-xl sm:text-2xl font-semibold royal text-gray-800 mb-2">${item.name}</h3>
                                <p class="text-gray-600 text-sm mb-4 line-clamp-2">${item.description}</p>

                                <div class="flex justify-between items-center">
                                    <span class="text-xl sm:text-2xl font-bold text-rose-600">₹${item.price}</span>
                                    <button class="bg-indigo-950 text-white px-4 sm:px-6 py-2 rounded-lg font-medium shadow-md hover:bg-indigo-900 transition-colors text-sm sm:text-base" onclick="addToCart(${item.id})">Add to Cart</button>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        searchResultsSection.classList.remove('hidden');
        document.getElementById('menu-items').classList.add('hidden');
    }

    function clearSearch() {
        document.getElementById('search-results-section').classList.add('hidden');
        document.getElementById('menu-items').classList.remove('hidden');
        currentSearchQuery = '';
    }

    function clearModalSearch() {
        document.getElementById('search-input').value = '';
        currentSearchQuery = '';
        showPopularSearches();
    }

    function addToCartFromSearch(itemId) {
        addToCart(itemId);
        // Show success message
        const item = MENU.find(i => i.id === itemId);
        if (item) {
            showMessage(`${item.name} added to your order!`, 'success');
        }
    }

    function renderCategories() {
        const container = document.getElementById('categories');
        const categories = [...new Set(MENU.map(item => item.category))];

        let html = `
            <button class="category-btn active bg-indigo-950 text-white px-3 sm:px-4 lg:px-6 py-1.5 sm:py-2 rounded-full font-medium shadow-md hover:bg-indigo-900 transition-colors text-xs sm:text-sm lg:text-base" onclick="filterMenu('All')">All</button>
        `;

        categories.forEach(category => {
            html += `
                <button class="category-btn bg-stone-200 text-gray-700 px-3 sm:px-4 lg:px-6 py-1.5 sm:py-2 rounded-full font-medium hover:bg-stone-300 transition-colors text-xs sm:text-sm lg:text-base" onclick="filterMenu('${category}')">${category}</button>
            `;
        });

        container.innerHTML = html;
    }

    function filterMenu(category) {
        clearSearch(); // Clear any active search when filtering

        const buttons = document.querySelectorAll('.category-btn');
        buttons.forEach(btn => {
            btn.classList.remove('active', 'bg-indigo-950', 'text-white');
            btn.classList.add('bg-stone-200', 'text-gray-700');
        });

        const activeBtn = document.querySelector(`[onclick="filterMenu('${category}')"]`);
        if (activeBtn) {
            activeBtn.classList.remove('bg-stone-200', 'text-gray-700');
            activeBtn.classList.add('active', 'bg-indigo-950', 'text-white');
        }

        renderMenu(category);
    }

    function renderMenu(category = 'All', itemsToRender = null) {
        const container = document.getElementById('menu-items');
        if (!container) return;

        const finalMenu = itemsToRender || (category === 'All' ? MENU : MENU.filter(item => item.category === category));

        if (finalMenu.length === 0) {
            container.innerHTML = `
                <div class="col-span-full text-center py-10 text-gray-500 text-lg">No items found. Please try another search.</div>
            `;
            return;
        }

        container.innerHTML = finalMenu.map(item => `
            <div class="bg-white rounded-2xl shadow-xl overflow-hidden transform transition duration-300 hover:scale-105">
                <div class="relative w-full h-40 sm:h-48 bg-gray-100">
                    <img src="${item.image}" alt="${item.name}" class="w-full h-full object-cover rounded-t-2xl">
                </div>

                <div class="p-4 sm:p-6">
                    <h3 class="text-xl sm:text-2xl font-semibold royal text-gray-800 mb-2">${item.name}</h3>
                    <p class="text-gray-600 text-sm mb-4 line-clamp-2">${item.description}</p>

                    <div class="flex justify-between items-center">
                        <span class="text-xl sm:text-2xl font-bold text-rose-600">₹${item.price}</span>
                        <button class="bg-indigo-950 text-white px-4 sm:px-6 py-2 rounded-lg font-medium shadow-md hover:bg-indigo-900 transition-colors text-sm sm:text-base" onclick="addToCart(${item.id})">Add to Cart</button>
                    </div>
                </div>
            </div>
        `).join('');
    }

    function addToCart(itemId) {
        const item = MENU.find(i => i.id === itemId);
        if (!item) return;

        if (cart[itemId]) {
            cart[itemId].quantity += 1;
        } else {
            cart[itemId] = { ...item, quantity: 1 };
        }

        updateCart();
        showMessage(`${item.name} added to your order!`, 'success');
    }

    function updateCart() {
        const items = Object.values(cart);
        const container = document.getElementById('cart-items');
        if (!container) return;

        if (items.length === 0) {
            container.innerHTML = `
                <div class="text-center text-gray-500 py-8">Your cart is empty.</div>
            `;
            document.getElementById('cart-count').textContent = '0';
            document.getElementById('send-btn').disabled = true;
            updateTotals(0);
            return;
        }

        container.innerHTML = items.map(item => `
            <div class="flex items-center justify-between border-b border-gray-100 pb-2 sm:pb-3 lg:pb-4 last:border-b-0 last:pb-0">
                <div class="flex items-center space-x-2 sm:space-x-3 lg:space-x-4 flex-1 min-w-0">
                    <img src="${item.image}" alt="${item.name}" class="w-8 h-8 sm:w-10 sm:h-10 lg:w-12 lg:h-12 rounded-xl object-cover flex-shrink-0">
                    <div class="min-w-0 flex-1">
                        <p class="font-medium text-gray-800 text-xs sm:text-sm lg:text-base truncate">${item.name}</p>
                        <p class="text-xs text-gray-500">₹${item.price} each</p>
                    </div>
                </div>

                <div class="flex items-center space-x-1 sm:space-x-2 flex-shrink-0">
                    <button class="bg-stone-200 text-gray-700 w-6 h-6 sm:w-7 sm:h-7 lg:w-8 lg:h-8 rounded-full flex items-center justify-center font-bold text-xs sm:text-sm lg:text-lg hover:bg-stone-300 transition-colors" onclick="changeQuantity(${item.id}, -1)">-</button>
                    <span class="font-semibold text-gray-800 w-4 sm:w-6 text-center text-xs sm:text-sm lg:text-base">${item.quantity}</span>
                    <button class="bg-stone-200 text-gray-700 w-6 h-6 sm:w-7 sm:h-7 lg:w-8 lg:h-8 rounded-full flex items-center justify-center font-bold text-xs sm:text-sm lg:text-lg hover:bg-stone-300 transition-colors" onclick="changeQuantity(${item.id}, 1)">+</button>
                </div>
            </div>
        `).join('');

        const totalItems = items.reduce((sum, item) => sum + item.quantity, 0);
        document.getElementById('cart-count').textContent = totalItems;
        document.getElementById('send-btn').disabled = false;

        const total = items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        updateTotals(total);
    }

    function changeQuantity(itemId, change) {
        if (cart[itemId]) {
            cart[itemId].quantity += change;
            if (cart[itemId].quantity <= 0) {
                delete cart[itemId];
            }
            updateCart();
        }
    }

    function updateTotals(total) {
        document.getElementById('total').textContent = `₹${total.toFixed(0)}`;
    }

    function savePreviousOrderToLocalStorage(orderData) {
        localStorage.setItem('previousOrder', JSON.stringify(orderData));
    }

    function displayPreviousOrder() {
        const previousOrderData = localStorage.getItem('previousOrder');
        const container = document.getElementById('previous-order-content');
        const section = document.getElementById('previous-order-section');

        if (previousOrderData && container && section) {
            const order = JSON.parse(previousOrderData);
            const orderDate = new Date(order.timestamp).toLocaleDateString();

            const itemsHtml = order.items.map(item => `
                <div class="flex justify-between text-xs sm:text-sm">
                    <span class="text-gray-600">${item.name} x ${item.quantity}</span>
                    <span class="font-medium text-gray-700">₹${item.price * item.quantity}</span>
                </div>
            `).join('');

            container.innerHTML = `
                <p class="text-gray-500 text-xs mb-2">Order placed on ${orderDate}</p>
                ${itemsHtml}
                <div class="flex justify-between font-bold text-sm sm:text-base mt-2 pt-2 border-t border-gray-300">
                    <span>Total</span>
                    <span>₹${order.total}</span>
                </div>
            `;

            section.classList.remove('hidden');
        } else if (section) {
            section.classList.add('hidden');
        }
    }

    // SEND ORDER TO GOOGLE SHEETS - REPLACED YOUR JSON FUNCTIONALITY
    async function sendToCloud() {
        const items = Object.values(cart);

        if (items.length === 0) {
            showMessage('Your cart is empty. Please add items before placing an order.', 'error');
            return;
        }

        const tableNumberInput = document.getElementById('table-number');
        const tableNumber = tableNumberInput.value.trim();

        if (!tableNumber || isNaN(tableNumber) || tableNumber < 1 || tableNumber > 50) {
            showMessage('Please enter a valid table number between 1 and 50.', 'error');
            tableNumberInput.focus();
            return;
        }

        const sendBtn = document.getElementById('send-btn');
        const sendBtnText = document.getElementById('send-btn-text');
        const spinner = document.getElementById('spinner');

        sendBtn.disabled = true;
        sendBtnText.textContent = 'Sending...';
        spinner.classList.remove('hidden');

        try {
            const total = items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const orderNumber = `C-${Date.now().toString().slice(-6)}`;
            const orderTime = new Date().toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit' });

            const orderData = {
                orderNumber: orderNumber,
                tableNumber: tableNumber,
                items: items,
                total: total.toFixed(0),
                orderTime: orderTime,
                timestamp: new Date().toISOString(),
                status: 'new',
                cloudId: `cloud_${Date.now()}`,
                deviceInfo: navigator.userAgent.substring(0, 100),
                location: Intl.DateTimeFormat().resolvedOptions().timeZone
            };

            const response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify(orderData)
            });

            if (response.ok) {
                showMessage(`Order ${orderNumber} for Table ${tableNumber} sent successfully!`, 'success');
                savePreviousOrderToLocalStorage(orderData);
                displayPreviousOrder();
                cart = {};
                updateCart();
                document.getElementById('table-number').value = '';
            } else {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }

        } catch (error) {
            console.error('Upload error:', error);
            showMessage(`Failed to send order: ${error.message}`, 'error');
        } finally {
            sendBtn.disabled = false;
            sendBtnText.textContent = 'Send Order';
            spinner.classList.add('hidden');
        }
    }

    function showMessage(text, type) {
        const msg = document.getElementById('message');
        if (!msg) return;

        msg.textContent = text;
        msg.className = `my-3 sm:my-4 p-2 sm:p-3 rounded-xl text-sm font-medium transition-opacity duration-500 ease-in-out block ${type === 'success' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`;

        setTimeout(() => {
            msg.classList.add('opacity-0');
            setTimeout(() => {
                msg.classList.add('hidden');
                msg.classList.remove('opacity-0');
            }, 500);
        }, 5000);
    }
</script>
</body>
</html>
