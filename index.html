<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bella Vista Restaurant - GitHub Direct</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: #333; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: white; border-radius: 15px; padding: 30px; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; }
        .restaurant-name { font-size: 3rem; color: #D2691E; margin-bottom: 10px; }
        .restaurant-tagline { color: #666; font-size: 1.2rem; }
        .github-setup { background: linear-gradient(45deg, #e8f5e8, #f0f8ff); border: 2px solid #28a745; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .github-title { color: #28a745; font-weight: bold; font-size: 1.2rem; margin-bottom: 10px; text-align: center; }
        .github-subtitle { color: #155724; font-size: 0.9rem; text-align: center; }
        .setup-panel { background: #fff3cd; border: 2px solid #ffc107; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .setup-title { color: #856404; font-weight: bold; margin-bottom: 15px; font-size: 1.1rem; }
        .setup-input { display: grid; grid-template-columns: 100px 1fr 80px; gap: 10px; margin-bottom: 15px; align-items: center; }
        .setup-input label { font-weight: 500; color: #495057; }
        .setup-input input { padding: 8px 12px; border: 1px solid #ced4da; border-radius: 4px; font-size: 0.9rem; }
        .setup-input input[type="password"] { font-family: monospace; }
        .setup-btn { background: #28a745; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-size: 0.8rem; }
        .setup-btn:hover { background: #218838; }
        .status-display { padding: 10px 15px; border-radius: 5px; margin: 10px 0; font-weight: 500; text-align: center; }
        .status-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status-warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .status-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .content-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 30px; }
        .menu-section { background: white; border-radius: 15px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .menu-section h2 { color: #D2691E; font-size: 2rem; margin-bottom: 20px; }
        .category-filters { display: flex; gap: 10px; margin-bottom: 30px; flex-wrap: wrap; }
        .category-btn { padding: 10px 20px; border: none; border-radius: 25px; background: #f8f9fa; color: #666; cursor: pointer; transition: all 0.3s; font-weight: 500; }
        .category-btn.active, .category-btn:hover { background: #D2691E; color: white; transform: translateY(-2px); }
        .menu-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .menu-item { border: 1px solid #ddd; border-radius: 10px; padding: 20px; background: #f8f9fa; transition: all 0.3s; }
        .menu-item:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .item-name { font-size: 1.3rem; font-weight: bold; color: #333; margin-bottom: 8px; }
        .item-description { color: #666; margin-bottom: 15px; line-height: 1.4; }
        .item-footer { display: flex; justify-content: space-between; align-items: center; }
        .item-price { font-size: 1.4rem; font-weight: bold; color: #D2691E; }
        .add-to-cart-btn { background: #28a745; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-weight: 500; transition: all 0.3s; }
        .add-to-cart-btn:hover { background: #218838; transform: translateY(-1px); }
        .cart-sidebar { background: white; border-radius: 15px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); height: fit-content; position: sticky; top: 20px; }
        .cart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .cart-header h3 { color: #D2691E; font-size: 1.5rem; }
        .cart-count { background: #D2691E; color: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .cart-items { max-height: 300px; overflow-y: auto; margin-bottom: 20px; }
        .cart-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #eee; }
        .cart-item:last-child { border-bottom: none; }
        .cart-item-info { flex: 1; }
        .cart-item-name { font-weight: 500; margin-bottom: 5px; }
        .cart-item-price { color: #666; font-size: 0.9rem; }
        .quantity-controls { display: flex; align-items: center; gap: 10px; margin: 10px 0; }
        .qty-btn { background: #D2691E; color: white; border: none; width: 25px; height: 25px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .qty-display { min-width: 30px; text-align: center; font-weight: 500; }
        .remove-item { background: #dc3545; color: white; border: none; padding: 3px 8px; border-radius: 3px; cursor: pointer; font-size: 0.8rem; }
        .cart-totals { border-top: 2px solid #ddd; padding-top: 15px; margin-bottom: 20px; }
        .total-row { display: flex; justify-content: space-between; margin: 5px 0; }
        .total-row.grand-total { font-weight: bold; font-size: 1.2rem; color: #D2691E; border-top: 1px solid #ddd; padding-top: 10px; margin-top: 10px; }
        .cart-actions { display: flex; flex-direction: column; gap: 10px; }
        .action-btn { padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: 500; transition: all 0.3s; text-align: center; }
        .generate-invoice-btn { background: #17a2b8; color: white; }
        .generate-invoice-btn:hover { background: #138496; }
        .direct-send-btn { background: #007bff; color: white; font-size: 1.1rem; }
        .direct-send-btn:hover { background: #0056b3; }
        .direct-send-btn.sending { background: #6c757d; cursor: not-allowed; }
        .direct-send-btn:disabled { background: #6c757d; cursor: not-allowed; }
        .empty-cart { text-align: center; color: #666; padding: 20px 0; }
        .success-message { background: #d4edda; color: #155724; padding: 15px; border-radius: 5px; margin-bottom: 20px; display: none; font-weight: 500; border: 1px solid #c3e6cb; }
        @media (max-width: 768px) { .content-grid { grid-template-columns: 1fr; } .restaurant-name { font-size: 2rem; } .menu-grid { grid-template-columns: 1fr; } .setup-input { grid-template-columns: 1fr; gap: 5px; } }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1 class="restaurant-name">üçΩÔ∏è Bella Vista Restaurant</h1>
            <p class="restaurant-tagline">GitHub Direct Send - apurv1155/qrapp</p>
        </header>

        <!-- GitHub Setup -->
        <div class="github-setup">
            <div class="github-title">üéØ DIRECT SEND TO receiver.html</div>
            <div class="github-subtitle">Customer: index.html ‚Üí System: orders.json ‚Üí Kitchen: receiver.html</div>
        </div>

        <!-- Setup Panel -->
        <div class="setup-panel">
            <div class="setup-title">‚öôÔ∏è Repository Setup (apurv1155/qrapp):</div>

            <div class="setup-input">
                <label>Token:</label>
                <input type="password" id="github-token" placeholder="github_pat_xxxxx..." maxlength="100">
                <button class="setup-btn" onclick="saveSetup()">Save</button>
            </div>

            <div id="setup-status" class="status-display status-warning">
                ‚ö†Ô∏è Add GitHub token above (GitHub.com ‚Üí Settings ‚Üí Developer settings ‚Üí Personal tokens ‚Üí Generate ‚Üí Contents: Write)
            </div>
        </div>

        <!-- Success Message -->
        <div id="success-message" class="success-message"></div>

        <!-- Main Content -->
        <div class="content-grid">
            <!-- Menu Section -->
            <section class="menu-section">
                <h2>Our Menu</h2>

                <!-- Category Filters -->
                <div class="category-filters">
                    <button class="category-btn active" data-category="all">All Items</button>
                    <button class="category-btn" data-category="Starters">Starters</button>
                    <button class="category-btn" data-category="Main Course">Main Course</button>
                    <button class="category-btn" data-category="Desserts">Desserts</button>
                    <button class="category-btn" data-category="Beverages">Beverages</button>
                </div>

                <!-- Menu Items Grid -->
                <div id="menu-items" class="menu-grid"></div>
            </section>

            <!-- Cart Sidebar -->
            <aside class="cart-sidebar">
                <div class="cart-header">
                    <h3>Your Order</h3>
                    <span id="cart-count" class="cart-count">0</span>
                </div>

                <div id="cart-items" class="cart-items"></div>

                <div class="cart-totals">
                    <div class="total-row">
                        <span>Subtotal:</span>
                        <span id="subtotal">$0.00</span>
                    </div>
                    <div class="total-row">
                        <span>Tax (10%):</span>
                        <span id="tax">$0.00</span>
                    </div>
                    <div class="total-row grand-total">
                        <span>Total:</span>
                        <span id="total">$0.00</span>
                    </div>
                </div>

                <div class="cart-actions">
                    <button id="generate-invoice-btn" class="action-btn generate-invoice-btn">Generate Invoice</button>
                    <button id="direct-send-btn" class="action-btn direct-send-btn" disabled>üéØ SEND TO receiver.html</button>
                </div>
            </aside>
        </div>
    </div>

    <script>
        // GitHub Direct Send System for apurv1155/qrapp

        const menuItems = [
            { id: 1, name: "Garlic Bread", category: "Starters", price: 8, description: "Fresh baked bread with garlic butter" },
            { id: 2, name: "Caesar Salad", category: "Starters", price: 12, description: "Crisp romaine lettuce with caesar dressing" },
            { id: 3, name: "Margherita Pizza", category: "Main Course", price: 18, description: "Classic pizza with tomato, mozzarella and basil" },
            { id: 4, name: "Chicken Alfredo", category: "Main Course", price: 22, description: "Creamy pasta with grilled chicken" },
            { id: 5, name: "Chocolate Cake", category: "Desserts", price: 10, description: "Rich chocolate cake with vanilla ice cream" },
            { id: 6, name: "Ice Cream", category: "Desserts", price: 6, description: "Vanilla, chocolate or strawberry" },
            { id: 7, name: "Coffee", category: "Beverages", price: 5, description: "Fresh brewed coffee" },
            { id: 8, name: "Fresh Juice", category: "Beverages", price: 7, description: "Orange, apple or mixed fruit juice" }
        ];

        let cart = {}, currentFilter = 'all', isSetupComplete = false;
        const config = { repo: 'apurv1155/qrapp', token: '', ordersFile: 'orders.json' };

        document.addEventListener('DOMContentLoaded', function() {
            loadConfig(); renderMenuItems(); setupEventListeners(); updateCartDisplay(); checkSetup();
        });

        function loadConfig() {
            const saved = localStorage.getItem('githubDirectConfig');
            if (saved) {
                const savedConfig = JSON.parse(saved);
                config.token = savedConfig.token || '';
                document.getElementById('github-token').value = config.token;
                if (config.token) testSetup();
            }
        }

        function checkSetup() {
            const sendBtn = document.getElementById('direct-send-btn');
            if (isSetupComplete) {
                sendBtn.disabled = false;
                sendBtn.textContent = 'üéØ SEND TO receiver.html';
            } else {
                sendBtn.disabled = true;
                sendBtn.textContent = '‚öôÔ∏è SETUP REQUIRED';
            }
        }

        async function testSetup() {
            const token = document.getElementById('github-token').value;
            if (!token) {
                updateSetupStatus('warning', '‚ö†Ô∏è Please enter GitHub token');
                isSetupComplete = false; checkSetup(); return;
            }

            try {
                const response = await fetch(`https://api.github.com/repos/${config.repo}`, {
                    headers: { 'Authorization': `Bearer ${token}`, 'Accept': 'application/vnd.github.v3+json' }
                });

                if (response.ok) {
                    updateSetupStatus('success', '‚úÖ Setup complete! Direct send to receiver.html ready');
                    isSetupComplete = true; checkSetup(); return true;
                } else if (response.status === 401) {
                    updateSetupStatus('error', '‚ùå Invalid token - Check your GitHub token');
                    isSetupComplete = false; checkSetup();
                } else {
                    updateSetupStatus('error', `‚ùå GitHub API error: ${response.status}`);
                    isSetupComplete = false; checkSetup();
                }
            } catch (error) {
                updateSetupStatus('error', '‚ùå Network error - Check internet connection');
                isSetupComplete = false; checkSetup();
            }
            return false;
        }

        async function saveSetup() {
            config.token = document.getElementById('github-token').value;
            localStorage.setItem('githubDirectConfig', JSON.stringify(config));
            const success = await testSetup();
            if (success) showSuccessMessage('‚úÖ Setup saved! Direct send to receiver.html is now active.');
        }

        function updateSetupStatus(type, message) {
            const statusEl = document.getElementById('setup-status');
            statusEl.className = `status-display status-${type}`;
            statusEl.textContent = message;
        }

        function setupEventListeners() {
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active'); currentFilter = this.dataset.category; renderMenuItems();
                });
            });
            document.getElementById('generate-invoice-btn').addEventListener('click', generateInvoice);
            document.getElementById('direct-send-btn').addEventListener('click', directSendToReceiver);
        }

        function renderMenuItems() {
            const container = document.getElementById('menu-items');
            const filteredItems = currentFilter === 'all' ? menuItems : menuItems.filter(item => item.category === currentFilter);
            container.innerHTML = filteredItems.map(item => `
                <div class="menu-item">
                    <div class="item-name">${item.name}</div>
                    <div class="item-description">${item.description}</div>
                    <div class="item-footer">
                        <div class="item-price">$${item.price}</div>
                        <button class="add-to-cart-btn" onclick="addToCart(${item.id})">Add to Cart</button>
                    </div>
                </div>
            `).join('');
        }

        function addToCart(itemId) {
            const item = menuItems.find(i => i.id === itemId);
            if (!item) return;
            if (cart[itemId]) { cart[itemId].quantity += 1; } else { cart[itemId] = { ...item, quantity: 1 }; }
            updateCartDisplay(); showSuccessMessage(`${item.name} added to cart!`);
        }

        function updateCartDisplay() {
            const cartItems = Object.values(cart), container = document.getElementById('cart-items');
            if (cartItems.length === 0) {
                container.innerHTML = '<div class="empty-cart">Your cart is empty</div>';
                document.getElementById('cart-count').textContent = '0';
                updateTotals(0, 0, 0); return;
            }
            container.innerHTML = cartItems.map(item => `
                <div class="cart-item">
                    <div class="cart-item-info">
                        <div class="cart-item-name">${item.name}</div>
                        <div class="cart-item-price">$${item.price} each</div>
                        <div class="quantity-controls">
                            <button class="qty-btn" onclick="updateQuantity(${item.id}, -1)">‚àí</button>
                            <span class="qty-display">${item.quantity}</span>
                            <button class="qty-btn" onclick="updateQuantity(${item.id}, 1)">+</button>
                        </div>
                        <button class="remove-item" onclick="removeFromCart(${item.id})">Remove</button>
                    </div>
                </div>
            `).join('');
            const totalItems = cartItems.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cart-count').textContent = totalItems;
            const subtotal = cartItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const tax = subtotal * 0.1, total = subtotal + tax;
            updateTotals(subtotal, tax, total);
        }

        function updateQuantity(itemId, change) {
            if (cart[itemId]) {
                cart[itemId].quantity += change;
                if (cart[itemId].quantity <= 0) delete cart[itemId];
                updateCartDisplay();
            }
        }

        function removeFromCart(itemId) { delete cart[itemId]; updateCartDisplay(); }

        function updateTotals(subtotal, tax, total) {
            document.getElementById('subtotal').textContent = `$${subtotal.toFixed(2)}`;
            document.getElementById('tax').textContent = `$${tax.toFixed(2)}`;
            document.getElementById('total').textContent = `$${total.toFixed(2)}`;
        }

        async function directSendToReceiver() {
            const cartItems = Object.values(cart);
            if (cartItems.length === 0) { showSuccessMessage('Cart is empty!', 'error'); return; }
            if (!isSetupComplete) { showSuccessMessage('‚ö†Ô∏è Please complete setup first', 'warning'); return; }

            const sendBtn = document.getElementById('direct-send-btn'), originalText = sendBtn.textContent;
            sendBtn.classList.add('sending'); sendBtn.textContent = 'SENDING TO receiver.html...'; sendBtn.disabled = true;

            try {
                const subtotal = cartItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                const tax = subtotal * 0.1, total = subtotal + tax, orderId = Date.now();
                const orderNumber = `DIRECT-${String(orderId).slice(-6)}`;

                const orderData = {
                    id: orderId, orderNumber, items: cartItems, subtotal, tax, total,
                    timestamp: new Date().toISOString(), status: 'pending', source: 'github-direct',
                    restaurant: 'Bella Vista', metadata: { createdAt: new Date().toISOString(), method: 'Direct Send to receiver.html' }
                };

                let allOrders = [], fileSha = null;
                try {
                    const existingResponse = await fetch(`https://api.github.com/repos/${config.repo}/contents/${config.ordersFile}`, {
                        headers: { 'Authorization': `Bearer ${config.token}`, 'Accept': 'application/vnd.github.v3+json' }
                    });
                    if (existingResponse.ok) {
                        const existingData = await existingResponse.json();
                        fileSha = existingData.sha; allOrders = JSON.parse(atob(existingData.content)).orders || [];
                    }
                } catch (error) { console.log('üìù Creating new orders file'); }

                allOrders.unshift(orderData);
                if (allOrders.length > 50) allOrders = allOrders.slice(0, 50);

                const jsonContent = JSON.stringify({
                    restaurant: 'Bella Vista', lastUpdated: new Date().toISOString(),
                    totalOrders: allOrders.length, method: 'direct-send-to-receiver', orders: allOrders
                }, null, 2);

                const commitData = {
                    message: `üéØ Direct to receiver.html: Order ${orderNumber} ($${total.toFixed(2)})`,
                    content: btoa(jsonContent), branch: 'main'
                };
                if (fileSha) commitData.sha = fileSha;

                const commitResponse = await fetch(`https://api.github.com/repos/${config.repo}/contents/${config.ordersFile}`, {
                    method: 'PUT',
                    headers: { 'Authorization': `Bearer ${config.token}`, 'Accept': 'application/vnd.github.v3+json', 'Content-Type': 'application/json' },
                    body: JSON.stringify(commitData)
                });

                if (commitResponse.ok) {
                    showSuccessMessage(`üéØ Order ${orderNumber} sent DIRECTLY to receiver.html! Kitchen will see it automatically within 10 seconds!`);
                    cart = {}; updateCartDisplay();
                } else {
                    const errorData = await commitResponse.json();
                    showSuccessMessage(`‚ùå Send failed: ${errorData.message || 'Unknown error'}`, 'error');
                }
            } catch (error) {
                showSuccessMessage('‚ùå Error with direct send. Check setup and internet.', 'error');
            } finally {
                sendBtn.classList.remove('sending'); sendBtn.textContent = originalText; sendBtn.disabled = !isSetupComplete;
            }
        }

        function generateInvoice() {
            const cartItems = Object.values(cart);
            if (cartItems.length === 0) { showSuccessMessage('Cart is empty!', 'error'); return; }
            showSuccessMessage('Invoice generated successfully!');
        }

        function showSuccessMessage(message, type = 'success') {
            const messageEl = document.getElementById('success-message');
            messageEl.textContent = message; messageEl.style.display = 'block';
            messageEl.style.backgroundColor = ''; messageEl.style.color = ''; messageEl.style.borderColor = '';
            switch (type) {
                case 'error': messageEl.style.backgroundColor = '#f8d7da'; messageEl.style.color = '#721c24'; messageEl.style.borderColor = '#f5c6cb'; break;
                case 'warning': messageEl.style.backgroundColor = '#fff3cd'; messageEl.style.color = '#856404'; messageEl.style.borderColor = '#ffeaa7'; break;
                default: messageEl.style.backgroundColor = '#d4edda'; messageEl.style.color = '#155724'; messageEl.style.borderColor = '#c3e6cb';
            }
            setTimeout(() => { messageEl.style.display = 'none'; }, 8000);
        }
    </script>
</body>
</html>